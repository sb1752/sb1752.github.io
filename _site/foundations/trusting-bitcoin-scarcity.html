<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Social Media Meta Tags -->
    <meta name="twitter:card" content="How can we trust that the total supply of Bitcoin will be capped at 21 million? Let's discuss Bitcoin and dive into some code." />
    <meta name="twitter:creator" content="@shaanbatra" />
    <meta property="og:url" content="/foundations/trusting-bitcoin-scarcity.html" />
    <meta property="og:title" content="Trusting Bitcoin's Scarcity" />
    <meta property="og:description" content="How can we trust that the total supply of Bitcoin will be capped at 21 million? Let's discuss Bitcoin and dive into some code." />
    
      <meta property="og:image" content="/assets/images/get-block-subsidy.png" />
    
    <title>Trusting Bitcoin's Scarcity</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="wrapper">
      <div class="header">
        <h1><a href="/">Shaan Batra</a></h1>
        <div>Bitcoin | Lightning | Nostr</div>
      </div>
      <nav class="subheader">
        <a href="/foundations">foundations</a>
        &centerdot;
        <a href="/superuser">superuser</a>
        &centerdot;
        <a href="/coding">coding</a>
        &centerdot;
        <a href="/investing">investing</a>
        &centerdot;
        <a href="/essays">essays</a>
      </nav>
      <section>
        <div class="post-title">
  <h1>Trusting Bitcoin's Scarcity</h1>
  <p>January 2022</p>
</div>

<div class="post-content">
  <p>How can we trust that the total supply of Bitcoin will be capped at 21 million? This comes up fairly often as a criticism from people outside the world of technology. Can’t the developers simply change it? Can’t it be hacked? Who even reads the algorithms? How would you know if it did change? Ironically, Bitcoin’s core ethos encourages this kind of skeptical thinking, at least when it comes from a place of genuine curiosity. A common phrase in the community is “Don’t trust. Verify.” So let’s explore these questions further and provide you with the knowledge and tools to verify this for yourself.</p>

<p>In my discussions with people, I have found that there are two fundamental misconceptions that underlie this concern about scarcity. The first is misunderstanding the difference between closed source and open source code. The second is misunderstanding the difference between the client-server model and a distributed peer-to-peer network. Though people have varying degrees of understanding about how Bitcoin works, let’s start with the most basic misconception that I tend to see people have.</p>

<p>When we say Bitcoin is open-source, this means that all the code - including the calculation of Bitcoin’s supply - is written, maintained and tested in public, available for anyone to see. This means everyone has access to the codebase. This doesn’t mean everyone knows how to read it of course. A certain amount of programming knowledge is required. But learning enough to follow along, especially just the critical parts of the codebase, is actually not that hard as I’ll show at the bottom of this post. One can also pay attention to discussions among developers in the community publicly debating the real-world implications of major code changes.</p>

<p>If you’re not in the software industry or are not an engineer, you might find the concept of open source to be pretty radical. Almost all the proprietary software of every major technology company, including companies like Google and Amazon, are built on top of and rely heavily on free, open source software. The idea that such sophisticated software used by all these technology companies is developed completely in the open solely through the volunteer efforts of developers without any immediate or obvious profit incentive is fairly unintuitive. This runs counter to the way the world works in nearly every other industry. And yet, that is how much of software technology evolves today. This in itself is one of first hurdles to understanding how Bitcoin works and how its code can be “trusted.”</p>

<p>However, let’s say you understand that Bitcoin is open source and what the implications of this are. You may still have doubts, wondering if developers can just change the code, forcing “users” to simply adopt the new changes. Or perhaps the code can be hacked and changed without the core developer team’s consent, again forcing “users” to abide by the new changes. The code may be transparent and publicly visible, but can it not still be changed unilaterally by developers?</p>

<p>The notion of “users” here is a faulty mental model, but is perfectly understandable since that is how people interact with most software today. For example, you may have a user account on Instagram. When a developer makes a change to the code, perhaps updating the color scheme and layout, you simply sign in and see the changes. You are forced into the new experience without giving your consent. This is an example of the client-server model. The user’s browser or phone is the client and that client requests and accesses data from the company’s servers, which limits what the client has access to. The client does not know what data the server will return or how that code is implemented or what data is collected from the client, etc.</p>

<p>Bitcoin, however, is not based on a client-server model. It’s a peer to peer distributed network. Instead of clients and centralized servers, there are only independent nodes. There is no central server where data is retrieved from. Instead, every node runs the software that is written by Bitcoin developers and therefore every node has full access to the code. And the data - which in this case is the entire blockchain of transactions - is stored separately on each individual node. In other words, every node has a copy of the complete codebase and the full blockchain data.</p>

<p>The nodes in aggregate form a peer to peer network. If a code update is made that is not supported by the network participants, node operators can choose not to run that software update on their node. If enough participants reject the update, the network continues to function as it did before, only accepting software updates that nodes agree to. <strong>Bitcoin’s rules therefore are determined by the consensus of a globally distributed network of nodes</strong>. No one individual entity, such as a centralized server in the case of Facebook (or Meta), can make any changes unilaterally.</p>

<p>This leaves another question. Can the consensus change? What if the distributed network of nodes decide to accept a change to the 21 million supply cap? It’s possible, but there is no reason to believe this will happen anytime soon for two reasons. One is ideological. People, such as myself, participate in Bitcoin because we align with the vision of a disinflationary monetary system as a superior alternative to the inflationary fiat system that exists today, regardless of how economists. The other reason has to do with self-interest. Bitcoiners are not incentivized to inflate away their own wealth by distributing more Bitcoin.</p>

<p>Today, there are thousands of Bitcoin full node operators all over the world. The network is permission-less and therefore anyone can join and run a node. There are many services such as <a href="https://getumbrel.com/" target="_blank">Umbrel</a> that make running a full node fairly effortless. As a full node operator myself, I take it as my responsibility to pay attention to the code changes that materially impact the direction and goals of Bitcoin. You can be sure I’m paying attention to something as critical as the total supply. So, as an exercise to clear up any lingering doubts and empower you to confirm this for yourself, let’s take a look at the Bitcoin core codebase and verify the 21 million supply cap.</p>

<hr />

<h3 id="verifying-bitcoins-supply">VERIFYING BITCOIN’S SUPPLY</h3>

<p><em>Note: This section is a bit dense and somewhat technical, but if you take the time to go through it, I think you’ll find it rewarding.</em></p>

<p>Something to mention before we dive in is that the 21 million number as the total supply is not actually enforced anywhere in the code. It is hardcoded as a sanity check in certain areas to ensure individual transactions cannot exceed that amount for example. But the total supply is derived based on the issuance of new Bitcoin in each new block. As a quick refresher, Bitcoin transactions are picked up and aggregated in a set of blocks. Roughly every 10 minutes, transactions are “mined” into a collection called a block. Blocks are then chained together forming the blockchain, which acts as the digital ledger and final record of account. New Bitcoin is issued every time a block is mined, as an incentive to the miner. This is known as the block subsidy and is how new Bitcoin enters the system<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p>

<p>Remember, Bitcoin is disinflationary meaning new Bitcoin periodically enters the system but that new amount decreases over time. Bitcoin is programmed such that every 210,000 blocks, the amount of Bitcoin issued as an incentive to miners is halved. Since a block is mined roughly every 10 minutes, 210,000 blocks equates to about four years (6 blocks an hour * 24 hours a day * 365 days a year * 4 years = roughly 210,000). Therefore every four years, Bitcoin’s block subsidy is halved. In the first four years of operation, the amount of Bitcoin issued to miners in each block was 50. Today, the amount of Bitcoin issued per block is 6.25. It went from 50 to 25 to 12.5 to 6.25. We are in the third halving cycle. After the 32nd halving, the Bitcoin reward goes to zero<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>.</p>

<p>With this in mind, let’s take a look at the <code class="language-plaintext highlighter-rouge">GetBlockSubsidy</code> function in Bitcoin’s code which can be found here: <a href="https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L1401" target="_blank">https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L1401</a>.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CAmount</span> <span class="nf">GetBlockSubsidy</span><span class="p">(</span><span class="kt">int</span> <span class="n">nHeight</span><span class="p">,</span> <span class="k">const</span> <span class="n">Consensus</span><span class="o">::</span><span class="n">Params</span><span class="o">&amp;</span> <span class="n">consensusParams</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">halvings</span> <span class="o">=</span> <span class="n">nHeight</span> <span class="o">/</span> <span class="n">consensusParams</span><span class="p">.</span><span class="n">nSubsidyHalvingInterval</span><span class="p">;</span>
    <span class="c1">// Force block reward to zero when right shift is undefined.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">halvings</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">CAmount</span> <span class="n">nSubsidy</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">COIN</span><span class="p">;</span>
    <span class="c1">// Subsidy is cut in half every 210,000 blocks which will occur approximately every 4 years.</span>
    <span class="n">nSubsidy</span> <span class="o">&gt;&gt;=</span> <span class="n">halvings</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">nSubsidy</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can see here that first we calculate the halvings by taking the <code class="language-plaintext highlighter-rouge">nheight</code> and dividing that by the <code class="language-plaintext highlighter-rouge">consensusParams.nSubsidyHalvingInterval</code>. The <code class="language-plaintext highlighter-rouge">nheight</code> refers to the number of the block at the top of the blockchain. Since every block increments this number by 1, this number effectively tells us how many blocks there are in total in the chain. The subsidy halving interval is a constant with a value that can be found here: <a href="https://github.com/bitcoin/bitcoin/blob/master/src/chainparams.cpp#L67" target="_blank">https://github.com/bitcoin/bitcoin/blob/master/src/chainparams.cpp#L67</a>.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">consensus</span><span class="p">.</span><span class="n">nSubsidyHalvingInterval</span> <span class="o">=</span> <span class="mi">210000</span><span class="p">;</span>
</code></pre></div></div>

<p>This division gives us the number of the halving cycle that we are currently on. For example, the current block height as of this writing is <code class="language-plaintext highlighter-rouge">720406</code>. Taking this number divided by <code class="language-plaintext highlighter-rouge">210000</code> gives us <code class="language-plaintext highlighter-rouge">3.43</code> which is rounded down to the nearest integer or <code class="language-plaintext highlighter-rouge">3</code>. In another words, this block is in the third halving cycle.</p>

<p>Let’s skip the next part checking whether the halvings is greater than 64 for now and move on to this line:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CAmount</span> <span class="n">nSubsidy</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">COIN</span><span class="p">;</span>
</code></pre></div></div>

<p>The subsidy is calculated in Satoshis instead of whole Bitcoin. <code class="language-plaintext highlighter-rouge">COIN</code> is defined in <a href="https://github.com/bitcoin/bitcoin/blob/623745ca74cf3f54b474dac106f5802b7929503f/src/consensus/amount.h#L15" target="_blank">this file</a> and is defined as 100,000,000. A Satoshi is the smallest unit of 1 Bitcoin, which is comprised of 100,000,000 Satoshis. For example, if 1 Bitcoin today is worth $35,000, then 1 Satoshi is worth $0.00035. The community shorthand for this is Sats.</p>

<p>Finally, let’s move on to the last line modifying the <code class="language-plaintext highlighter-rouge">nSubsidy</code>.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nSubsidy</span> <span class="o">&gt;&gt;=</span> <span class="n">halvings</span><span class="p">;</span>
</code></pre></div></div>

<p>You’ll notice a unique operator here which you likely haven’t seen before, <code class="language-plaintext highlighter-rouge">&gt;&gt;=</code>. This is known as a bitwise operation. This is a bit too technical for this blog post, but what this does is convert the subsidy number to binary format and then does an operation by which it “shifts” bits by the number of halvings. This is the mathematical equivalent of dividing by the number 2, three times. Or the same as dividing by 2^3 which is 8. Essentially we divide the initial block subsidy of 50 bitcoin by 2 for every halving cycle to calculate the current block subsidy. 50/8 = 6.25.</p>

<p>Ok now that we understand this code a little better, how do we derive the 21 million number? From here, it’s just math. The total amount of bitcoin is the sum of all block subsidies over time:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>210,000*50 + 210,000*25 + 210,000*12.5 + … + 210,000* (50/(2^32))
</code></pre></div></div>

<p>Which is the equivalent of:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>210,000 * ( 50 + 25 + 12.5 + 6.25 + … + (50/(2^32)) )
</code></pre></div></div>

<p>What does the set in parenthesis equal? We can calculate it programmatically or by using a spreadsheet. Or we can approximate it using a <a href="https://en.wikipedia.org/wiki/Geometric_series" target="_blank">geometric series</a>. The geometric series formula tells us that this is roughly the same as <code class="language-plaintext highlighter-rouge">a / (1-r)</code> where a is the initial number and r is the ratio (0.5). Therefore the set in parenthesis equals <code class="language-plaintext highlighter-rouge">50 / (1-0.5)</code> or <code class="language-plaintext highlighter-rouge">100</code>. And <code class="language-plaintext highlighter-rouge">100 * 210,000 = 21 million</code>! We’ve confirmed the supply cap! In actuality, the number is slightly less than this since we just did an approximation which assumes an infinite series.</p>

<p>Let’s revisit that check that we skipped above.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="p">(</span><span class="n">halvings</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<p>Here, the subsidy reward is being forced to 0 after the 64th halving. The reason for this has to do with the implementation of the bitwise shift-by operation. After 64, shifting by 65 bits is the equivalent to shifting by 1 bit. A fix for this was introduced in 2014 <a href="https://github.com/bitcoin/bitcoin/pull/3842" target="_blank">https://github.com/bitcoin/bitcoin/pull/3842</a>. Before that fix, what this meant was that after around 250 years, the Bitcoin network would begin issuing new Bitcoin again which would break the 21 million hard cap!<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>.</p>

<p>As a Bitcoin node operator, I am paying close attention to any changes to these numbers and formulas, such as the <code class="language-plaintext highlighter-rouge">nSubsidyHalvingInterval</code> or any change to the bit shift operation, or any change to this function that calculates the block subsidy. Now you can verify it for yourself as well.</p>

<p>Hopefully, you were able to follow along, have a better understanding of how Bitcoin works and can even verify the 21 million supply cap for yourself. If this was helpful or confusing or if you have any questions, feel free to let me know on Twitter: <a href="https://twitter.com/shaanbatra" target="_blank">@shaanbatra</a>.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>This is a very simplistic explanation of the mining process which is often misunderstood and considered unnecessary and even harmful to the environment. However, this process is in fact essential to the functioning of the Bitcoin network. Real-world energy consumption offers the perfect balance of security and decentralization required to ensure Bitcoin is a viable long-term store of value. I will be writing more about how the mining process works and why it is essential in another post. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>After 32 halvings, the amount of the Bitcoin subsidy goes below a Satoshi, which is the smallest denomination. Therefore, no more Bitcoin is issued after that point. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p><a href="https://twitter.com/aantonop/status/1259835712859451393" target="_blank">https://twitter.com/aantonop/status/1259835712859451393</a> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

</div>

      </section>
    </div>
    <footer>
    </footer>
  </body>
</html>
